version: "3"

networks:
    hyper:
        external: true

services:
    zookeeper0:
        image: hyperledger/fabric-zookeeper
        hostname: zookeeper0
        ports:
            - '2181'
            - '2888'
            - '3888'
        environment:
            - ZOO_MY_ID=1
            - ZOO_SERVERS=server.1=zookeeper0:2888:3888 server.2=zookeeper1:2888:3888 server.3=zookeeper2:2888:3888
        networks:
            hyper:
                aliases:
                    - zookeeper0
  
    zookeeper1:
        image: hyperledger/fabric-zookeeper
        hostname: zookeeper1
        ports:
            - '2181'
            - '2888'
            - '3888'
        environment:
            - ZOO_MY_ID=2
            - ZOO_SERVERS=server.1=zookeeper0:2888:3888 server.2=zookeeper1:2888:3888 server.3=zookeeper2:2888:3888
        networks:
            hyper:
                aliases:
                    - zookeeper1
  
    zookeeper2:
        image: hyperledger/fabric-zookeeper
        hostname: zookeeper2
        ports:
            - '2181'
            - '2888'
            - '3888'
        environment:
            - ZOO_MY_ID=3
            - ZOO_SERVERS=server.1=zookeeper0:2888:3888 server.2=zookeeper1:2888:3888 server.3=zookeeper2:2888:3888
        networks:
            hyper:
                aliases:
                    - zookeeper2
  
    kafka0:
        image: hyperledger/fabric-kafka
        hostname: kafka0
        environment:
            - KAFKA_MESSAGE_MAX_BYTES=103809024 # 99 * 1024 * 1024 B
            - KAFKA_REPLICA_FETCH_MAX_BYTES=103809024 # 99 * 1024 * 1024 B
            - KAFKA_UNCLEAN_LEADER_ELECTION_ENABLE=false
            # KAFKA SPECIFIC
            - KAFKA_BROKER_ID=0
            - KAFKA_MIN_INSYNC_REPLICAS=2
            - KAFKA_DEFAULT_REPLICATION_FACTOR=3
            - KAFKA_ZOOKEEPER_CONNECT=zookeeper0:2181,zookeeper1:2181,zookeeper2:2181
        ports:
            - '9092'
        networks:
            hyper:
                aliases:
                    - kafka0
        depends_on:
          - zookeeper0
          - zookeeper1
          - zookeeper2
  
    kafka1:
        image: hyperledger/fabric-kafka
        hostname: kafka1
        environment:
            - KAFKA_MESSAGE_MAX_BYTES=103809024 # 99 * 1024 * 1024 B
            - KAFKA_REPLICA_FETCH_MAX_BYTES=103809024 # 99 * 1024 * 1024 B
            - KAFKA_UNCLEAN_LEADER_ELECTION_ENABLE=false
            # KAFKA SPECIFIC
            - KAFKA_BROKER_ID=1
            - KAFKA_MIN_INSYNC_REPLICAS=2
            - KAFKA_DEFAULT_REPLICATION_FACTOR=3
            - KAFKA_ZOOKEEPER_CONNECT=zookeeper0:2181,zookeeper1:2181,zookeeper2:2181
        networks:
            hyper:
                aliases:
                    - kafka1
        depends_on:
            - zookeeper0
            - zookeeper1
            - zookeeper2
  
    kafka2:
        image: hyperledger/fabric-kafka
        hostname: kafka2
        environment:
            - KAFKA_MESSAGE_MAX_BYTES=103809024 # 99 * 1024 * 1024 B
            - KAFKA_REPLICA_FETCH_MAX_BYTES=103809024 # 99 * 1024 * 1024 B
            - KAFKA_UNCLEAN_LEADER_ELECTION_ENABLE=false
            # KAFKA SPECIFIC
            - KAFKA_BROKER_ID=2
            - KAFKA_MIN_INSYNC_REPLICAS=2
            - KAFKA_DEFAULT_REPLICATION_FACTOR=3
            - KAFKA_ZOOKEEPER_CONNECT=zookeeper0:2181,zookeeper1:2181,zookeeper2:2181
        networks:
            hyper:
                aliases:
                    - kafka2
        depends_on:
            - zookeeper0
            - zookeeper1
            - zookeeper2
  
    kafka3:
        image: hyperledger/fabric-kafka
        hostname: kafka3
        environment:
            - KAFKA_MESSAGE_MAX_BYTES=103809024 # 99 * 1024 * 1024 B
            - KAFKA_REPLICA_FETCH_MAX_BYTES=103809024 # 99 * 1024 * 1024 B
            - KAFKA_UNCLEAN_LEADER_ELECTION_ENABLE=false
            # KAFKA SPECIFIC
            - KAFKA_BROKER_ID=3
            - KAFKA_MIN_INSYNC_REPLICAS=2
            - KAFKA_DEFAULT_REPLICATION_FACTOR=3
            - KAFKA_ZOOKEEPER_CONNECT=zookeeper0:2181,zookeeper1:2181,zookeeper2:2181
        depends_on:
            - zookeeper0
            - zookeeper1
            - zookeeper2
        networks:
            hyper:
                aliases:
                    - kafka3
